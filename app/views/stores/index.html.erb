<div class="ui padded grid" style="padding-top:20px">
  <h1 class="ui header">Dashboard - All Stores</h1>


  <div class="ui two column stackable divided padded grid">
    <div class="row">
      <div class="sixteen wide column">
        <div class="ui horizontal divider">Waiting</div>

        <table class="ui celled sortable unstackable table">
          <thead>
            <tr>
              <th>Store/Branch</th>
              <th>Customers Served</th>
              <th>Queue</th>
              <th>Avg Wait Time</th>
              <th>Details</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <div class="ui animated compact button" tabindex="0">
                  <a id='new-store-submit'>
                    <div class="visible content"><i class="add square icon"></i>Add a store/branch</div>
                    <div class="hidden content">
                      <i class="right arrow icon"></i>
                    </div>
                  </a>
                </div>
              </td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
            <% @stores.each do |store| %>
            <tr>
              <td><%= store.store_name %></td>
              <td><%= store.historical_customers.where(store_id: store.id, status_id: 4).count %></td>
              <td>
                <!-- QUEUE SEGMENT -->
                <% total_time = 0 %>
                <% store.customers.order(:queue_no).each do |customer| %>
                  <% wait_time =  (Time.now.utc - customer.created_at)/60 %>
                  <% total_time += wait_time %>
                  <% if wait_time > 30 %>
                    <i class="orange male icon" style="padding:0; margin:-5px"></i>
                  <% elsif wait_time > 10 %>
                    <i class="yellow male icon" style="padding:0; margin:-5px"></i>
                  <% else %>
                    <i class="olive male icon" style="padding:0; margin:-5px"></i>
                  <% end %>
                <% end %>
                <% avg_time = total_time/store.customers.count %>
              </td>
              <td><%= avg_time.round(0) %><% if avg_time.round(0) > 1 %> <%= "minute".pluralize %><% else %>minute<% end %></td>
              <td class="selectable"><a href='/stores/<%= store.id %>'>Store Dashboard</a></td>
            </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>


  <!-- NEW STORE MODAL: UNHIDDEN BY JAVASCRIPT -->
      <div class="ui modal" id='new-store-modal'>
        <i class="close icon"></i>
        <div class="ui padded grid" style="padding-top:20px">
          <h1 class="ui header">New store info</h1>
          <div class="sixteen wide column">
            <div class="ui form" id='store-details'>
              <form action='/stores' method='post'>
                <h4 class="ui dividing header">Store Details</h4>
                <div class="field">
                  <div class="two fields">
                    <div class="six wide field">
                      <label>Store Name</label>
                      <div class="ui left icon input">
                        <input type="text" placeholder="" name="store[store_name]">
                        <i class="building icon"></i>
                      </div>
                    </div>
                    <div class="ten wide field">
                      <label>Store Address</label>
                      <div class="ui left icon input">
                        <input type="text" placeholder="" name="store[store_address]">
                        <i class="marker icon"></i>
                      </div>
                    </div>
                  </div>
                  <div class="two fields">
                    <div class="eight wide field">
                      <label>Store Manager</label>
                      <div class="ui left icon input">
                        <input type="text" placeholder="" name="store[contact_person]">
                        <i class="user icon"></i>
                      </div>
                    </div>
                    <div class="eight wide field">
                      <label>Contact No</label>
                      <div class="ui left icon input">
                        <input type="text" placeholder="" name="store[contact_no]">
                        <i class="mobile icon"></i>
                      </div>
                    </div>
                  </div>
                </div>
                <h4 class="ui dividing header">Settings</h4>
                <div class="three fields">
                  <div class="four wide field">
                    <label>Max Queue No</label>
                    <div class="ui left icon input">
                      <input type="text" placeholder="" name="store[max_queue_no]">
                      <i class="ticket icon"></i>
                    </div>
                  </div>
                  <div class="four wide field">
                    <label>Max Leeway</label>
                    <div class="ui left icon input">
                      <input type="text" placeholder="" name="store[max_leeway]">
                      <i class="share icon"></i>
                    </div>
                  </div>
                  <div class="eight wide field">
                    <label>Reservation Fee</label>
                    <div class="ui left icon input">
                      <input type="text" placeholder="" name="store[reservation_fee]">
                      <i class="money icon"></i>
                    </div>
                  </div>
                </div>
                <button class="ui positive right floated button" type="submit" name="action">Save</button>
                <div class="ui error message"></div>
              </form>
            </div>
          </div>
        </div>
      </div>
