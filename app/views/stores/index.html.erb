<div class="ui padded grid" style="padding-top:20px">
  <h1 class="ui header">Dashboard - All Stores</h1>


  <div class="ui two column stackable divided padded grid">
    <div class="row">
      <div class="sixteen wide column">
        <div class="ui horizontal divider">Waiting</div>

        <table class="ui celled sortable unstackable table">
          <thead>
            <tr>
              <th>Store/Branch</th>
              <th>Customers Served</th>
              <th>Queue</th>
              <th>Avg Wait Time</th>
              <th>Details</th>
            </tr>
          </thead>
          <tbody>
            <% @stores.each do |store| %>
            <tr>
              <td><%= store.store_name %></td>
              <td></td>
              <td>
                <!-- QUEUE SEGMENT -->
                <% total_time = 0 %>
                <% store.customers.order(:queue_no).each do |customer| %>
                  <% wait_time =  (Time.now.utc - customer.created_at)/60 %>
                  <% total_time += wait_time %>
                  <% if wait_time > 30 %>
                    <i class="orange male icon" style="padding:0; margin:-5px"></i>
                  <% elsif wait_time > 10 %>
                    <i class="yellow male icon" style="padding:0; margin:-5px"></i>
                  <% else %>
                    <i class="olive male icon" style="padding:0; margin:-5px"></i>
                  <% end %>
                <% end %>
                <% avg_time = total_time/store.customers.count %>
              </td>
              <td><%= avg_time.round(0) %><% if avg_time.round(0) > 1 %><%= "minute".pluralize %><% else %>minute<% end %></td>
              <td class="selectable"><a href='/stores/<%= store.id %>'>Store Dashboard</a></td>
            </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ADD NEW STORES -->
  <div class="ui animated button" tabindex="0">
    <a href="/stores/new">
      <div class="visible content">New Store</div>
      <div class="hidden content">
        <i class="right arrow icon"></i>
      </div>
    </a>
  </div>
</div>


<% @stores.each do |store| %>

<div class="ui centered compact center aligned segment grid">
  <div class="content">
    <div class="header"><%= link_to store.store_name, '/stores/'+store.id.to_s, method: :get %></div>
    <div class="meta">
      <div class="ui horizontal segments">
        <!-- QUEUE SEGMENT -->
        <div class="ui segment">
          <% percentage = store.customers.count % 100 %>
          <% puts "hello this is % #{percentage}" %>
          <% for i in 0..19 %>
            <% unless percentage < i %>
              <i class="green male icon" style="padding:0; margin:-5px"></i>
            <%else%>
              <i class="male icon" style="padding:0; margin:-5px"></i>
            <% end %>
          <% end %>
        </div>

        <!-- Calculate Est. Time SEGMENT -->
        <% total_time = 0 %>
        <% store.customers.each do |customer| %>
          <% wait_time =  Time.now.utc - customer.created_at %>
          <% total_time += wait_time %>
        <% end %>
        <div class="ui segment"><i class="hourglass half icon"></i><%= (total_time).floor %></div>

        <!-- TOTAL QUEUE  -->
        <div class="ui segment">
          <i class="users icon"></i>
        </div>
      </div>
    </div>
  </div>
</div>


<% end %>
